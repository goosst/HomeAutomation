homeassistant:
  # Name of the location where Home Assistant is running
  name: Home
  # Location required to calculate the time the sun rises and sets
  latitude: !secret gps_lat
  longitude: !secret gps_long
  # Impacts weather/sunrise data (altitude above sea level in meters)
  elevation: 0
  # metric for Metric, imperial for Imperial
  unit_system: metric
  # Pick yours from here: http://en.wikipedia.org/wiki/List_of_tz_database_time_zones
  time_zone: Europe/Brussels
  # Customization file
  # customize: !include customize.yaml

# Configure a default setup of Home Assistant (frontend, api, etc)
default_config:

lovelace:
  mode: yaml


# Show the introduction message on startup.
introduction:

# Uncomment this if you are using SSL/TLS, running in Docker container, etc.
# http:
#   base_url: example.duckdns.org:8123

# Discover some devices automatically
discovery:

mqtt:
  broker: 127.0.0.1
  username: stijn
  password: !secret pass_mqtt
  discovery: true

sensor:
  - platform: yr
    name: weather_yr
    forecast: 24
    monitored_conditions:
      - temperature
      - precipitation
      - windDirection
      - windSpeed
      - symbol
  - platform: mqtt
    name: "Temperature living"
    state_topic: sensor/thermostat/temperature
    unit_of_measurement: "째C"
  - platform: mqtt
    name: "Temperature setpoint living"
    state_topic: sensor/thermostat/temperature_set
    unit_of_measurement: "째C"
  - platform: mqtt
    name: "Temperature flow radiator"
    state_topic: sensor/thermostat/temperature_flowtemp
    unit_of_measurement: "째C"
  - platform: buienradar
    monitored_conditions:
      - conditioncode
      - conditiondetailed
      - temperature
      - groundtemperature
      - windspeed
      - winddirection
      - rainchance_1d
      - rain_1d
      - precipitation
      - precipitation_forecast_average
      - irradiance
      - symbol

shell_command:
  set_temp_high: python3 /home/homeassistant/.homeassistant/python_scripts/set_temperature_on.py
  set_temp_low: python3 /home/homeassistant/.homeassistant/python_scripts/set_temperature_off.py
  read_ebus: python3 /home/homeassistant/.homeassistant/python_scripts/readtime_thermostat.py
  set_temp_living: 'python3 /home/homeassistant/.homeassistant/python_scripts/set_temperature.py -t {{ states.input_number.slider1.state }}'

history_graph:
  gr1:
    name: temperature living
    entities:
      - sensor.temperature_setpoint_living
      - sensor.temperature_living
    hours_to_show: 72
    refresh: 600
  gr2:
    name: temperature heater
    entities:
      - sensor.temperature_flow_radiator
    hours_to_show: 72
    refresh: 600

input_number:
  slider1:
    name: Set temperature
    initial: 21
    min: 5
    max: 30
    step: 0.25
    unit_of_measurement: "째C"

automation slider:
  - alias: set_temperature_living
    trigger:
      platform: state
      entity_id: input_number.slider1
    action:
      service: shell_command.set_temp_living

automation leaving_house:
  alias: set temp low when leaving house
  trigger:
    platform: state
    entity_id: device_tracker.7c_7d_3d_ba_ef_be
    from: 'home'
    to: 'not_home'
  action:
    service: shell_command.set_temp_low
    data:
      message: "Stijn left house: heating low"

automation at_home:
  alias: set temp high when being home
  trigger:
    platform: time_pattern
    minutes: '/5'
  condition:
    condition: and
    conditions:
      - condition: time
        after: '06:30:00'
        before: '22:30:00'
      - condition: state
        entity_id: device_tracker.7c_7d_3d_ba_ef_be
        state: 'home'
  action:
    service: shell_command.set_temp_high
    data:
      message: "Stijn is home: heating high"

automation sleep:
  alias: sleep, turn heating down
  trigger:
    platform: time
    at: '22:35:00'
  action:
    service: shell_command.set_temp_low
    data:
      message: "sleeping, heating low"

automation wakeup:
  alias: wakup, turn heating up
  trigger:
    platform: time
    at: '06:25:00'
  action:
    service: shell_command.set_temp_high
    data:
      message: "wakeup, heating high"

automation ebusreading:
  alias: read ebus
  trigger:
    platform: time_pattern
    minutes: '/7'
  action:
    service: shell_command.read_ebus
    data:
      message: "thermostat reading"


#NMAP is unreliable without scan_options
device_tracker:
  - platform: nmap_tracker
    hosts: 192.168.0.1-254
    consider_home: 600
    interval_seconds: 180
    scan_options: " -min-rtt-timeout 3s " #scan_options: " -min-rtt-timeout 3s --privileged -sP "

#group: !include groups.yaml
#automation: !include automations.yaml
#script: !include scripts.yaml
